
CREATE SEQUENCE permisos_id_permiso_seq;

CREATE TABLE PERMISOS (
                ID_PERMISO INTEGER NOT NULL DEFAULT nextval('permisos_id_permiso_seq'),
                DESCRIPCION VARCHAR NOT NULL,
                CONSTRAINT permisos_pk PRIMARY KEY (ID_PERMISO)
);


ALTER SEQUENCE permisos_id_permiso_seq OWNED BY PERMISOS.ID_PERMISO;

CREATE SEQUENCE rol_id_rol_seq;

CREATE TABLE ROL (
                ID_ROL INTEGER NOT NULL DEFAULT nextval('rol_id_rol_seq'),
                DESCRIPCION VARCHAR NOT NULL,
                STATUS INTEGER NOT NULL,
                CONSTRAINT rol_pk PRIMARY KEY (ID_ROL)
);


ALTER SEQUENCE rol_id_rol_seq OWNED BY ROL.ID_ROL;

CREATE SEQUENCE rol_permisos_id_rol_seq;

CREATE TABLE ROL_PERMISOS (
                ID_ROL INTEGER NOT NULL DEFAULT nextval('rol_permisos_id_rol_seq'),
                ID_PERMISO INTEGER NOT NULL,
                FECHA_CREACION DATE,
                CONSTRAINT rol_permisos_pk PRIMARY KEY (ID_ROL, ID_PERMISO)
);


ALTER SEQUENCE rol_permisos_id_rol_seq OWNED BY ROL_PERMISOS.ID_ROL;

CREATE SEQUENCE projects_id_seq;

CREATE TABLE PROJECTS (
                ID_PROJECT INTEGER NOT NULL DEFAULT nextval('projects_id_seq'),
                NOMBRE VARCHAR NOT NULL,
                DESCRIPCION VARCHAR,
                FECHA_INICIO DATE NOT NULL,
                FECHA_FIN DATE NOT NULL,
                CONSTRAINT projects_pk PRIMARY KEY (ID_PROJECT)
);


ALTER SEQUENCE projects_id_seq OWNED BY PROJECTS.ID_PROJECT;

CREATE SEQUENCE sprint_id__seq;

CREATE TABLE SPRINT (
                ID_SPRINT INTEGER NOT NULL DEFAULT nextval('sprint_id__seq'),
                NOMBRE VARCHAR NOT NULL,
                FECHA_INICIO DATE NOT NULL,
                FECHA_FIN DATE NOT NULL,
                DESCRIPCION VARCHAR,
                ID_PROJECT INTEGER NOT NULL,
                CONSTRAINT sprint_pk PRIMARY KEY (ID_SPRINT)
);


ALTER SEQUENCE sprint_id__seq OWNED BY SPRINT.ID_SPRINT;

CREATE SEQUENCE USUARIO_history_id_seq;

CREATE TABLE USUARIO_HISTORY (
                ID_HISTORY INTEGER NOT NULL DEFAULT nextval('USUARIO_history_id_seq'),
                NOMBRE VARCHAR NOT NULL,
                FECHA_CREACION DATE NOT NULL,
                STATUS INTEGER NOT NULL,
                DESCRIPCION VARCHAR NOT NULL,
                ID_SPRINT INTEGER NOT NULL,
                CONSTRAINT USUARIO_history_pk PRIMARY KEY (ID_HISTORY)
);


ALTER SEQUENCE USUARIO_history_id_seq OWNED BY USUARIO_HISTORY.ID_HISTORY;

CREATE SEQUENCE groups_id_seq;

CREATE TABLE GROUPS (
                ID_GROUP INTEGER NOT NULL DEFAULT nextval('groups_id_seq'),
                ID_PROJECT INTEGER,
                DESCRIPCION VARCHAR,
                CONSTRAINT groups_pk PRIMARY KEY (ID_GROUP)
);


ALTER SEQUENCE groups_id_seq OWNED BY GROUPS.ID_GROUP;

CREATE SEQUENCE USUARIO_id_seq;

CREATE TABLE USUARIO (
                ID_USUARIO INTEGER NOT NULL DEFAULT nextval('USUARIO_id_seq'),
                ID_GROUP INTEGER,
                ID_ROL INTEGER,
                NOMBRE VARCHAR NOT NULL,
                APELLIDO VARCHAR NOT NULL,
                STATUS INTEGER NOT NULL,
                PASSWORD VARCHAR NOT NULL,
                EMAIL VARCHAR NOT NULL,
                FECHA_CREACION_USUARIO DATE NOT NULL,
                FECHA_ASIGNACION_ROL DATE,
                CONSTRAINT USUARIO_pk PRIMARY KEY (ID_USUARIO)
);


ALTER SEQUENCE USUARIO_id_seq OWNED BY USUARIO.ID_USUARIO;

CREATE UNIQUE INDEX idx_email
 ON USUARIO
 ( EMAIL );

ALTER TABLE ROL_PERMISOS ADD CONSTRAINT permisos_rol_permisos_fk
FOREIGN KEY (ID_PERMISO)
REFERENCES PERMISOS (ID_PERMISO)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE ROL_PERMISOS ADD CONSTRAINT rol_rol_permisos_fk
FOREIGN KEY (ID_ROL)
REFERENCES ROL (ID_ROL)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE USUARIO ADD CONSTRAINT rol_USUARIO_fk
FOREIGN KEY (ID_ROL)
REFERENCES ROL (ID_ROL)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE SPRINT ADD CONSTRAINT projects_sprint_fk
FOREIGN KEY (ID_PROJECT)
REFERENCES PROJECTS (ID_PROJECT)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE GROUPS ADD CONSTRAINT projects_groups_fk
FOREIGN KEY (ID_PROJECT)
REFERENCES PROJECTS (ID_PROJECT)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE USUARIO_HISTORY ADD CONSTRAINT sprint_USUARIO_history_fk
FOREIGN KEY (ID_SPRINT)
REFERENCES SPRINT (ID_SPRINT)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE USUARIO ADD CONSTRAINT groups_USUARIO_fk
FOREIGN KEY (ID_GROUP)
REFERENCES GROUPS (ID_GROUP)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;